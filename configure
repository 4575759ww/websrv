#! /bin/bash
# This file is NOT gnerated by autoconf
#

# Make a temp directory in build tree.
TMPDIR=$(mktemp -d config.XXXXXX)
trap 'status=$?; rm -rf $TMPDIR; exit $status' EXIT HUP INT QUIT TERM

check_toolchain()
{
    : ${PKG_CONFIG:=pkg-config}
    : ${AR=ar}
    : ${CC=gcc}
    echo "PKG_CONFIG:=${PKG_CONFIG}" >>Config
    echo "AR:=${AR}" >>Config
    echo "CC:=${CC}" >>Config
}

# generate headers
rm -f Config
rm -f include/config.h

check_toolchain

JSON_PARSER="y"
JSON_SERIALIZER="y"
SESSION="y"
PROXY="y"
RESTSERVER="y"
STATICFILES="y"

while [[ $# -ge 1 ]]
do
    key="$1"

    case $key in
        --disable-json-parser)
            JSON_PARSER="n"
            ;;
        --disable-json-serializer)
            JSON_SERIALIZER="n"
            ;;
        --disable-session)
            SESSION="n"
            ;;
        --disable-proxy)
            PROXY="n"
            ;;
        --disable-rest)
            RESTSERVER="n"
            ;;
        --disable-static)
            STATICFILES="n"
            ;;
        *)
            echo "unknown option $key"
            exit -1
            ;;
    esac
    shift
done

echo -n "Compiling with JSON parser: "
if [ "$JSON_PARSER" == "y" ]; then
    echo "yes"
    echo "#define JSON_PARSER 1" >> include/config.h
else
    echo "no"
    echo "/* #undef JSON_PARSER */" >> include/config.h
fi

echo -n "Compiling with JSON serializer: "
if [ "$JSON_SERIALIZER" == "y" ]; then
    echo "yes"
    echo "#define JSON_SERIALIZER 1" >> include/config.h
else
    echo "no"
    echo "/* #undef JSON_SERIALIZER */" >> include/config.h
fi

echo -n "Compiling with session management: "
if [ "$SESSION" == "y" ]; then
    echo "yes"
    echo "#define HAVE_SESSION 1" >> include/config.h
else
    echo "no"
    echo "/* #undef HAVE_SESSION */" >> include/config.h
fi

echo -n "Compiling with reverse proxy: "
if [ "$PROXY" == "y" ]; then
    echo "yes"
    echo "#define HAVE_PROXY 1" >> include/config.h
else
    echo "no"
    echo "/* #undef HAVE_PROXY */" >> include/config.h
fi

echo -n "Compiling with rest backend: "
if [ "$RESTSERVER" == "y" ]; then
    echo "yes"
    echo "#define HAVE_REST 1" >> include/config.h
else
    echo "no"
    echo "/* #undef HAVE_REST */" >> include/config.h
fi

echo -n "Compiling with static file backend: "
if [ "$STATICFILES" == "y" ]; then
    echo "yes"
    echo "#define HAVE_STATIC 1" >> include/config.h
else
    echo "no"
    echo "/* #undef HAVE_STATIC */" >> include/config.h
fi

